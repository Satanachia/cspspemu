dist: bionic
services:
  - docker
#install:
  # https://dotnet.microsoft.com/download/linux-package-manager/ubuntu18-04/sdk-current

  #- wget https://download.visualstudio.microsoft.com/download/pr/ece856bb-de15-4df3-9677-67cc817ffc1b/521da52132d23deae5400b8e19e23691/dotnet-sdk-2.2.204-linux-x64.tar.gz
  #- mkdir -p ~/dotnet
  #- tar -C ~/dotnet -xzf dotnet-sdk-2.2.204-linux-x64.tar.gz
   
  #- sudo apt-get install -y gpg
  #- wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.asc.gpg
  #- sudo mv microsoft.asc.gpg /etc/apt/trusted.gpg.d/
  #- wget -q https://packages.microsoft.com/config/ubuntu/18.04/prod.list
  #- sudo mv prod.list /etc/apt/sources.list.d/microsoft-prod.list
  #- sudo chown root:root /etc/apt/trusted.gpg.d/microsoft.asc.gpg
  #- sudo chown root:root /etc/apt/sources.list.d/microsoft-prod.list
  #- sudo apt-get install -y apt-transport-https
  #- sudo apt-get update
  #- sudo apt-get install dotnet-sdk-2.1
script:
  #- dotnet test
  #- ~/dotnet/dotnet test
  - docker run -v $PWD:/project mcr.microsoft.com/dotnet/core/sdk:2.2 bash -c "cd /project; dotnet test"
before_cache:
  # Save tagged docker images
  - >
    mkdir -p $HOME/docker && docker images -a --filter='dangling=false' --format '{{.Repository}}:{{.Tag}} {{.ID}}'
    | xargs -n 2 -t sh -c 'test -e $HOME/docker/$1.tar.gz || docker save $0 | gzip -2 > $HOME/docker/$1.tar.gz'
before_install:
  # Load cached docker images
  - if [[ -d $HOME/docker ]]; then ls $HOME/docker/*.tar.gz | xargs -I {file} sh -c "zcat {file} | docker load"; fi
cache:
  bundler: true
  directories:
    - $HOME/docker
